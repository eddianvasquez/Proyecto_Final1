@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Web
@using Proyecto_Final1.Components.Account
@inject NavigationManager NavManager
@inject IdentityRedirectManager RedirectManager

<nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <NavLink href="/" class="flex items-center space-x-2">
                <i class="fas fa-leaf text-2xl text-green-600"></i>
                <span class="text-xl font-bold text-green-700">Mercado Orgánico</span>
            </NavLink>
        </div>

        <div class="hidden md:flex items-center space-x-6">
            <!-- Botón de Inicio añadido -->
            <NavLink href="/" class="text-gray-700 hover:text-green-600 transition-colors" Match="NavLinkMatch.All">Inicio</NavLink>
            <NavLink href="/productos" class="text-gray-700 hover:text-green-600 transition-colors">Productos</NavLink>
            <NavLink href="/nosotros" class="text-gray-700 hover:text-green-600 transition-colors">Nosotros</NavLink>
            <NavLink href="/contacto" class="text-gray-700 hover:text-green-600 transition-colors">Contacto</NavLink>
        </div>

        <div class="flex items-center space-x-4">
            <!-- Lógica de menú de administrador para el rol 'Admin' -->
            <AuthorizeView Roles="Admin">
                <div class="relative">
                    <button @onclick="ToggleAdminMenu" class="text-green-700 hover:text-green-600 focus:outline-none transition-colors p-2">
                        <!-- Ícono de hoja de "ojita" -->
                        <i class="fas fa-leaf text-xl"></i>
                    </button>
                    @if (showAdminMenu)
                    {
                        <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <!-- Links a las páginas de administrador -->
                            <NavLink href="/admin/CrearProducto" @onclick="ToggleAdminMenu"
                                     class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                Crear Producto
                            </NavLink>
                            <NavLink href="/admin/EditarProducto" @onclick="ToggleAdminMenu"
                                     class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                Administrar Productos
                            </NavLink>
                            <NavLink href="/reportes/ventas" @onclick="ToggleAdminMenu"
                                     class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                Reporte de Ventas
                            </NavLink>
                            <NavLink href="/Admin/Preguntas" @onclick="ToggleAdminMenu"
                                     class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                Administrar Preguntas
                            </NavLink>
                            <NavLink href="/admin/consultas" @onclick="ToggleAdminMenu"
                                     class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                Administrar Consulta
                            </NavLink>
                            <NavLink href="/admin/pedidos" @onclick="ToggleAdminMenu"
                                     class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                Administrar Pedidos
                            </NavLink>
                        </div>
                    }
                </div>
            </AuthorizeView>

            <AuthorizeView>
                <Authorized>
                    <NavLink href="/perfil" class="p-2 text-gray-700 hover:text-green-600 transition-colors">
                        <i class="fas fa-user text-xl"></i>
                    </NavLink>
                    <form action="Account/Logout" method="post" class="inline">
                        <AntiforgeryToken />
                        <input type="hidden" name="ReturnUrl" value="@NavManager.ToBaseRelativePath(NavManager.Uri)" />
                        <button type="submit" class="p-2 text-gray-700 hover:text-red-600 transition-colors">
                            <i class="fas fa-sign-out-alt text-xl"></i>
                        </button>
                    </form>
                </Authorized>
                <NotAuthorized>
                    <NavLink href="/Account/Login" class="p-2 text-gray-700 hover:text-green-600 transition-colors">
                        <i class="fas fa-user text-xl"></i>
                    </NavLink>
                </NotAuthorized>
            </AuthorizeView>

            <NavLink href="/carrito" class="relative p-2 text-gray-700 hover:text-green-600 transition-colors">
                <i class="fas fa-shopping-cart text-xl"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-green-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
                    @cartCount
                </span>
            </NavLink>

            <button class="md:hidden p-2 text-gray-700 hover:text-green-600 transition-colors" @onclick="ToggleMobileMenu">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </div>

    @if (showMobileMenu)
    {
        <div class="md:hidden bg-white shadow-lg py-4">
            <div class="flex flex-col items-center space-y-4">
                <NavLink href="/" @onclick="ToggleMobileMenu" class="text-gray-700 hover:text-green-600 transition-colors">Inicio</NavLink>
                <NavLink href="/productos" @onclick="ToggleMobileMenu" class="text-gray-700 hover:text-green-600 transition-colors">Productos</NavLink>
                <NavLink href="/nosotros" @onclick="ToggleMobileMenu" class="text-gray-700 hover:text-green-600 transition-colors">Nosotros</NavLink>
                <NavLink href="/contacto" @onclick="ToggleMobileMenu" class="text-gray-700 hover:text-green-600 transition-colors">Contacto</NavLink>
            </div>
        </div>
    }
</nav>

<div class="page">
    <main>
        <article class="content">
            @Body
        </article>
    </main>
</div>

<footer id="contact" class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h3 class="text-xl font-bold mb-4">Mercado Orgánico</h3>
                <p class="text-gray-400">Ofreciendo los productos más frescos desde 2010.</p>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Contacto</h3>
                <p class="text-gray-400 mb-2"><i class="fas fa-map-marker-alt mr-2"></i> Av. Ecológica 123, Ciudad</p>
                <p class="text-gray-400 mb-2"><i class="fas fa-phone mr-2"></i> (123) 456-7890</p>
                <p class="text-gray-400"><i class="fas fa-envelope mr-2"></i> info@mercadoorganico.com</p>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Horario</h3>
                <p class="text-gray-400 mb-1">Lunes - Viernes: 8am - 8pm</p>
                <p class="text-gray-400 mb-1">Sábado: 9am - 6pm</p>
                <p class="text-gray-400">Domingo: 10am - 4pm</p>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
            <p>© @DateTime.Now.Year Mercado Orgánico. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>

@code {
    private bool showMobileMenu = false;
    private bool showAdminMenu = false; // Agregado para el menú de admin
    private int cartCount = 0; // Propiedad para el contador del carrito

    protected override void OnInitialized()
    {
        // En una aplicación real, aquí obtendrías el número de artículos del carrito
        // desde un servicio de estado o una base de datos.
        // Por ejemplo: cartCount = CarritoService.GetItemsCount();
        cartCount = 3; // Valor de ejemplo para mostrar la funcionalidad
    }

    private void ToggleMobileMenu()
    {
        showMobileMenu = !showMobileMenu;
    }

    // Método agregado para el menú de administrador
    private void ToggleAdminMenu()
    {
        showAdminMenu = !showAdminMenu;
    }
}